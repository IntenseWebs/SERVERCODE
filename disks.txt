# https://linuxconfig.org/linux-lvm-logical-volume-manager
# apt-get install lvm2 # sudo dnf install lvm2
# fdisk -l # lsblk # lsblk -fe7 # blkid # parted -l # parted /dev/sde u s p # df -hT # du -sh /home #
# Check FREE SPACE # sfdisk --list-free /dev/vda # hwinfo --short --block # cat /proc/partitions # sudo hdparm -t --direct /dev/nvme0n1p1
# pvs, vgs, lvs, pvdisplay, vgdisplay, lvdisplay

# WIPE DESTROY DISK CONTENTS
dd if=/dev/zero of=/dev/sdb  bs=512  count=1
# shred -n 5 -vz /dev/sdb
# scrub -p dod /dev/sdb

# PARTITION ON CMD LINE
# cfdisk /dev/sdb
fdisk /dev/sdb # then m, p, g, n, w, q

# CREATE LVM VOLUME(s)
pvcreate /dev/sdb1
vgcreate vgiso /dev/sdb1
lvcreate vgiso -l 100%FREE -n iso
pvcreate /dev/sdb2
vgcreate vgvm /dev/sdb2
lvcreate vgvm -l 100%FREE -n vm
pvcreate /dev/sdb3
vgcreate vgbackups /dev/sdb3
lvcreate vgbackups -l 100%FREE -n backups
# lvcreate vgextra-vm -L 500G -n vg-vm vgextra
# lvcreate vgextra-backups -L 900G -n vg-backups vgextra
lvdisplay
mkfs.ext4 -m 0 /dev/vg_extra/vg-iso
mkfs.ext4 -m 0 /dev/vg_extra/vg-vm
mkfs.ext4 -m 0 /dev/vg_extra/vg-backups
mkdir /iso && mkdir /vm && mkdir /backups
vi /etc/fstab
/dev/vg_extra/vg-iso    /iso    ext4    defaults        0       0
/dev/vg_extra/vg-vm     /vm     ext4    defaults        0       0
/dev/vg_extra/vg-backups        /backups    ext4    defaults        0       0
systemctl daemon-reload
mount -a

# REMOVE LVM VOLUME
pvremove /dev/sdb --force --force
umount /dev/vg_extra/vg-backups
lvremove /dev/vg_extra/vg-backups

# RESIZE LVM AS ROOT: https://www.golinuxcloud.com/lvm-shrink-logical-volume/
df -hT /home
lsblk -f
umount /home
fsck -f /dev/mapper/pg--vg-home
resize2fs /dev/mapper/pg--vg-home 5G
lvreduce -r -L 5G /dev/mapper/pg--vg-home
mount /dev/mapper/pg--vg-home /home

# Extend the logical volume zeus-vg/var by 4G
lvextend -L+4G /dev/mapper/zeus--vg-var
# resize the ext4 filesystem in logical volume zeus-vg/var to the new volume size
resize2fs /dev/mapper/zeus--vg-var
# lvextend --resizefs -l +100%FREE /dev/mapper/vg_debian-lv_root

#RESIZE ext4 - # unmount /home because an ext4 filesystem cannot be reduced while mounted
umount /home
fsck -f /dev/mapper/zeus--vg-home
resize2fs /dev/mapper/zeus--vg-home 50G
# reduce the logical volume zeus-vg/home to 50G
lvreduce -L50G /dev/mapper/zeus--vg-home
# remount /home
mount /home

# MOUNT OTHER DRIVES
cd/media
mkdir 2TBSEAGATE
mkdir 1TBNVME
 cd /etc
 mkdir backup
 cp /etc/fstab /etc/backup/fstab
 vi /etc/fstab
/dev/sda1       /media/2TBSEAGATE       ext4    defaults        0       2
/dev/nvme1n1p1  /media/1TBNVME          ext4    defaults        0       2

# CREATE NEW SNAPSHOT
lvcreate /dev/mapper/<SOURCE VOLUMEGROUP NAME> -L 1G -s -n snapshot_name
lvs
# Mount a snapshot
mount /dev/mapper/vg_extra-web_snapshot_20240624 /mnt/extra/snapshot
# Restore a snapshot, Umount the original volume:
umount /path/to/mounted/logical-volume
lvconvert --merge /dev/mapper/snapshot_name
# Deactivate/reactivate to fresh it:
lvchange -an /dev/mapper/vg_extra-lv_web
lvchange -ay /dev/mapper/vg_extra-lv_web
